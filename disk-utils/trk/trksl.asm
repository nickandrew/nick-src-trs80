*GET	DOSCALLS

	ORG	5200H
START	DI
	LD	HL,6200H
	LD	DE,6201H
	LD	BC,2000H
	LD	(HL),0
	LDIR
	LD	A,1
	LD	(37E1H),A
	LD	BC,2000H
	CALL	ROM@PAUSE
	LD	HL,37ECH
	LD	(HL),0
	LD	B,10
	DJNZ	$
LOOP2	BIT	0,(HL)
	JR	NZ,LOOP2
LOOP	CALL	INSSCE
	LD	A,41H
	LD	(3C00H),A
	LD	BC,6200H
	CALL	READ
	LD	B,1
LOOP3	CALL	STOUT
	DJNZ	LOOP3
	CALL	PROCESS
	CALL	INSDES
	LD	A,41H
	LD	(3C02H),A
	LD	BC,07200H
	CALL	WRITE
	JP	LOOP
INSSCE	LD	HL,SMES
	JP	WTINP
SMES	DEFM	'INSERT <SOURCE> DISK AND HIT RETURN:'
	DEFB	0DH
DMES	DEFM	'INSERT <DESTINATION> DISK AND HIT RETURN:'
	DEFB	0DH
INSDES	LD	HL,DMES
WTINP	LD	A,(HL)
	CALL	ROM@PUT_VDU
	INC	HL
	CP	0DH
	JR	NZ,WTINP
LOOP4	LD	A,(38FFH)
	OR	A
	JR	NZ,LOOP4
LOOP5	LD	A,(3840H)
	AND	1
	JR	Z,LOOP5
	LD	A,0DH
	CALL	ROM@PUT_VDU
	LD	A,1
	LD	(37E1H),A
	LD	BC,4000H
	CALL	ROM@PAUSE
	RET
STOUT	PUSH	BC
	LD	A,1
	LD	(37E1H),A
	LD	A,60H
	LD	(37ECH),A
	LD	B,6
	DJNZ	$
LOOP6	LD	A,(37ECH)
	BIT	0,A
	JR	NZ,LOOP6
	POP	BC
	RET
READ	LD	A,1
	PUSH	BC
	LD	(37E1H),A
	LD	A,0E4H
	LD	(37ECH),A
	LD	B,6
	DJNZ	$
	POP	BC
TEST1	LD	A,(37ECH)
	BIT	0,A
	JR	Z,GOUT
	BIT	1,A
	JR	Z,TEST1
	LD	A,(37EFH)
	LD	(BC),A
	INC	BC
	JR	TEST1
GOUT	LD	A,0FFH
	LD	(BC),A
	INC	BC
	LD	(BC),A
	LD	B,6
	DJNZ	$
	LD	A,1
	LD	(37E1H),A
	LD	A,40H
	LD	(37ECH),A
	LD	B,6
	DJNZ	$
LOOP8	LD	A,(37ECH)
	BIT	0,A
	JR	NZ,LOOP8
	RET
WRITE	LD	A,1
	PUSH	BC
	LD	(37E1H),A
	LD	A,0F4H
	LD	(37ECH),A
	LD	B,6
	DJNZ	$
	POP	BC
	LD	HL,37ECH
TEST2	BIT	0,(HL)
	JR	Z,GOUT2
	BIT	1,(HL)
	JR	Z,TEST2
	LD	A,(BC)
	LD	(37EFH),A
	INC	BC
	JR	TEST2
GOUT2	LD	A,0FFH
	LD	(BC),A
	INC	BC
	LD	(BC),A
	LD	B,6
	DJNZ	$
	LD	A,1
	LD	(37E1H),A
	LD	A,40H
	LD	(37ECH),A
	LD	B,6
	DJNZ	$
LOOP10	LD	A,(37ECH)
	BIT	0,A
	JR	NZ,LOOP10
	RET
POKDE	LD	(DE),A
	INC	DE
	DJNZ	POKDE
	RET
PROCESS	LD	HL,6200H
;STORE PRECEDING INFO.
	LD	DE,7200H
	LD	A,0FFH
	LD	B,40
	CALL	POKDE
	LD	A,0
	LD	B,6
	CALL	POKDE
	LD	A,0FCH	;INDEX MARK
	LD	(DE),A
	INC	DE
	LD	A,0FFH
	LD	B,26
	CALL	POKDE
P_SECT	LD	A,(HL)
	CP	0FEH
	INC	HL
	JR	NZ,P_SECT
	XOR	A
	LD	B,6
	CALL	POKDE
	DEC	HL
X1	INC	HL
	LD	A,(HL)
	CP	0FEH
	JR	Z,X1
	LD	A,0FEH
	LD	(DE),A
	INC	DE
	LD	BC,4
	LDIR
	INC	HL
	INC	HL
	LD	A,0F7H
	LD	(DE),A
	INC	DE
	LD	A,0FFH
	LD	B,11
	CALL	POKDE
	XOR	A
	LD	B,6
	CALL	POKDE
R_SV01	LD	A,(HL)
	INC	HL
	CP	0FFH
	JR	Z,R_SV01
	CP	0F8H
	JR	C,R_SV01
	LD	(DE),A
	INC	DE
	LD	A,0E5H
	LD	B,0
	CALL	POKDE
	LD	A,0F7H
	LD	(DE),A
	INC	DE
	LD	A,0FFH
	LD	B,27
	CALL	POKDE
	INC	H
	INC	HL
	INC	HL
	LD	B,64
X2	LD	A,(HL)
	CP	0FEH
	JR	Z,P_SECT
	INC	HL
	DJNZ	X2
	LD	B,0
	LD	A,0FFH
	CALL	POKDE
	EI
	JP	DOS_NOERROR
	END	START
