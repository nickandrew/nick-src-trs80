;fastfmtt/asm: Test possibility of a fast format
; for disk.
; Ver 1.0 on 03-Jan-85.
;

*GET	DOSCALLS

	ORG	5200H
START	CALL	SPIN
	CALL	RESTORE
	LD	B,40
LOOP_1	PUSH	BC
	CALL	WT_INDEX
	CALL	WT_INDEX
	CALL	STEP_IN
	POP	BC
	DJNZ	LOOP_1
	JP	DOS_NOERROR
;
SPIN	LD	A,1
	LD	(37E1H),A
	RET
;
RESTORE	CALL	SPIN
	XOR	A
	LD	(37ECH),A
	LD	B,10
	DJNZ	$
RS_1	LD	A,(37ECH)
	AND	1
	RET	Z
	CALL	SPIN
	JR	RS_1
;
STEP_IN	CALL	SPIN
	LD	A,40H
	LD	(37ECH),A
	LD	B,10
	DJNZ	$
SI_1	LD	A,(37ECH)
	AND	1
	RET	Z
	CALL	SPIN
	JR	SI_1
;
WT_INDEX
	CALL	SPIN
WI_1	LD	A,(37ECH)
	AND	2
	JR	NZ,WI_2
	CALL	SPIN
	JR	WI_1
;
WI_2	LD	A,(37ECH)
	AND	2
	RET	Z
	CALL	SPIN
	JR	WI_2
;
	END	START
