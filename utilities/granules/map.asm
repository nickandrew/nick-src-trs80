;MAP: SHOWS FREE GRANULES IN VISUAL FORM.
; Assembled OK 30-Mar-85.

*GET	DOSCALLS

	ORG	5200H
MAP	LD	HL,M$MAP
	CALL	MESS_DO
	LD	A,0
	CALL	490AH
	LD	HL,4200H
LOOP1	LD	A,(HL)
	AND	03H
	CALL	NUMBER
	RRCA
	CALL	C,PRHASH
	CALL	NC,PRNULL
	CALL	COMMA
	RRCA
	CALL	C,PRHASH
	CALL	NC,PRNULL
	CALL	CR
	CALL	DELAY
	INC	HL
	LD	A,L
	CP	40
	JR	NZ,LOOP1
	JP	DOS_NOERROR
NUMBER	PUSH	AF
	PUSH	BC
	PUSH	DE
	PUSH	HL
	LD	A,L
	LD	B,2FH
NUMV01	INC	B
	SUB	10
	JR	NC,NUMV01
	ADD	A,10
	PUSH	AF
	LD	A,B
	CALL	ROM@PUT_VDU
	POP	AF
	OR	30H
	CALL	ROM@PUT_VDU
	LD	A,':'
	CALL	ROM@PUT_VDU
	LD	A,' '
	CALL	ROM@PUT_VDU
	POP	HL
	POP	DE
	POP	BC
	POP	AF
	RET
DELAY	PUSH	AF
	PUSH	BC
	LD	BC,0C000H
	CALL	ROM@PAUSE
	POP	BC
	POP	AF
	RET
COMMA	PUSH	AF
	PUSH	HL
	LD	A,','
PRINT2	CALL	ROM@PUT_VDU
	POP	HL
	POP	AF
	RET
CR	PUSH	AF
	PUSH	HL
	LD	A,0DH
	JR	PRINT2
PRHASH	PUSH	AF
	PUSH	BC
	PUSH	DE
	PUSH	HL
	LD	HL,M$FULL
PRINT	CALL	MESS_DO
	POP	HL
	POP	DE
	POP	BC
	POP	AF
	RET
PRNULL	PUSH	AF
	PUSH	BC
	PUSH	DE
	PUSH	HL
	LD	HL,M$EMPT
	JR	PRINT
M$FULL	DEFM	'*************'
	DEFB	03H
M$EMPT	DEFM	'***       ***'
	DEFB	03H
M$MAP	DEFM	'MAP OF DISK SPACE:'
	DEFB	0DH
	END	MAP
