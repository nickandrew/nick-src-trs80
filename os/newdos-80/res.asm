;RES: LOADS IN VARIOUS SYSTEM FILES
;TO MEMORY THEN ACTS AS SYSLOAD.
; Assembled OK 30-Mar-85.
ORIG	EQU	0FC00H
	ORG	ORIG
SYSRES	LD	HL,4BDAH
	LD	(HL),21H
	INC	HL
	LD	(HL),17H
	INC	HL
	LD	(HL),43H
	LD	HL,4318H
	CALL	NEXTWORD
	PUSH	HL
	LD	HL,TABLE
	PUSH	HL
	POP	DE
	INC	DE
	LD	(HL),0
	LD	BC,255
	LDIR
	POP	HL
RDSYS	LD	A,(HL)
	CP	0DH
	JP	NZ,NODOS
	LD	HL,(CRLOAD)
	LD	(4049H),HL
	CALL	SETUP
	JP	DOS
NODOS	CALL	GETNUM
	CALL	READSYS
	JR	RDSYS
NEXTWORD	LD	A,(HL)
	INC	HL
	CP	21H
	JR	NC,NEXTWORD
	DEC	HL
NEXV01	LD	A,(HL)
	INC	HL
	CP	20H
	JR	Z,NEXV01
	DEC	HL
	RET
GETNUM	LD	(CST),HL
	PUSH	HL
	POP	BC
	LD	HL,0
GETV01	CALL	GETCH
	JR	Z,GPAST
	LD	A,L
	LD	(CURSYS),A
	PUSH	BC
	POP	HL
	LD	(CEN),HL
	RET
GPAST	PUSH	HL
	POP	DE
	ADD	HL,HL
	ADD	HL,HL
	ADD	HL,DE
	ADD	HL,HL
	ADD	A,L
	LD	L,A
	JR	GETV01
GETCH	LD	A,(BC)
	INC	BC
	CP	0DH
	JR	Z,CHEND
	CP	20H
	JR	NZ,GCHV01
GCHL01	LD	A,(BC)
	INC	BC
	CP	20H
	JR	Z,GCHL01
CHEND	LD	A,0FFH
	DEC	BC
	OR	A
	RET
GCHV01	CP	3AH
	JR	NC,GETCH
	CP	30H
	JR	C,GETCH
	SUB	30H
	LD	D,A
	XOR	A
	LD	A,D
	RET
READSYS	LD	A,(CURSYS)
	LD	HL,(CRTPS)
	LD	(HL),A
	INC	HL
	PUSH	HL
	LD	HL,(CRLOAD)
	EX	DE,HL
	POP	HL
	LD	(HL),E
	INC	HL
	LD	(HL),D
	INC	HL
	LD	(CRTPS),HL
	LD	HL,(CST)
	LD	DE,BUFF1
MV01	LD	A,(HL)
	CP	20H
	JR	Z,MV02
	LD	(DE),A
	INC	HL
	INC	DE
	JR	MV01
MV02	LD	A,0DH
	LD	(DE),A
	LD	HL,BUFF1
	LD	DE,FCB
	CALL	EXTRACT
	LD	HL,DEFEXT
	LD	DE,FCB
	CALL	EXTEND
	LD	HL,BUFF1
	LD	DE,FCB
	LD	B,0
	CALL	OPEN$EX
	JP	NZ,DOSERR
	LD	HL,(CRLOAD)
LV01	LD	DE,FCB
	CALL	READ$RC
	JR	NZ,LV02
	LD	B,0
	CALL	POKE
	JR	LV01
LV02	CP	1DH
	JR	NZ,LV05
	LD	A,(FCB+8)
	LD	B,A
LV03	CALL	POKE
LV04	LD	(CRLOAD),HL
	LD	DE,FCB
	CALL	CLOSE
	LD	HL,(CEN)
	RET
LV05	CP	1CH
	JP	NZ,DOSERR
	JR	LV04
POKE	LD	DE,BUFF1
POKV01	LD	A,(DE)
	LD	(HL),A
	INC	DE
	DEC	HL
	DJNZ	POKV01
	RET
SETUP	LD	HL,4BDAH
	LD	(HL),195
	LD	HL,MESS1
	CALL	MESS$DI
	LD	HL,SLOAD
	LD	(4BDBH),HL
	RET
SLOAD	LD	HL,4317H
	CP	(HL)
	JP	Z,4C19H
	LD	(HL),A
	LD	B,A
	DEC	B
	DEC	B
	LD	HL,TABLE
SEARCH	LD	A,(HL)
	OR	A
	JR	NZ,BYPE
	LD	A,B
	INC	A
	INC	A
	LD	HL,4317H
	JP	4BE1H
BYPE	CP	B
	JR	Z,MLOAD
	INC	HL
	INC	HL
	INC	HL
	JR	SEARCH
MLOAD	INC	HL
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	EX	DE,HL
MLOV01	LD	A,(HL)
	DEC	HL
	CP	2
	JR	NZ,MLOV02
	DEC	HL
	LD	E,(HL)
	DEC	HL
	LD	D,(HL)
	EX	DE,HL
	LD	(4C1EH),HL
	JP	4C19H
MLOV02	CP	1
	JR	Z,MLOV04
	LD	B,(HL)
	DEC	HL
MLOV03	DEC	HL
	DJNZ	MLOV03
	JR	MLOV01
MLOV04	LD	B,(HL)
	DEC	HL
	LD	E,(HL)
	DEC	HL
	LD	D,(HL)
	DEC	HL
	DEC	B
	DEC	B
MLOV05	LD	A,(HL)
	LD	(DE),A
	DEC	HL
	INC	DE
	DJNZ	MLOV05
	JR	MLOV01
MESS1	DEFM	'NOW PATCHING DOS FOR SYSTEM AUTO-LOAD'
	DEFB	0AH
	DEFM	'SYSRES VERSION 1.01 (AUGUST 28, 1983).'
	DEFB	0DH
CST	DEFW	0
CEN	DEFW	0
CRTPS	DEFW	TABLE
TABLE	EQU	ORIG-256
DEFEXT	DEFM	'SYS'
CURSYS	DEFB	0
CRLOAD	DEFW	TABLE-1
BUFF1	EQU	5200H
FCB	EQU	5300H
	ORG	0FE00H
AEI	DEFM	'APPEND'
	RET	NZ
	LD	L,B
	NOP	
	DEFM	'ATTRIB'
	ADD	A,L
	JP	(HL)
	ADC	A,B
	DEFM	'AUTO'
	ADD	A,H
	JP	(HL)
	NOP	
	DEFM	'BASIC2'
	DEFW	0EB86H
	NOP	
	DEFM	'BLINK'
	ADD	A,C
	PUSH	HL
	NOP	
	DEFM	'BOOT'
	ADC	A,D
	EX	DE,HL
	DEFB	10H
	DEFM	'BREAK'
	ADD	A,L
	PUSH	HL
	NOP	
	DEFM	'CHAIN'
	JP	8AEBH
	DEFM	'CHNON'
	PUSH	BC
	EX	DE,HL
	NOP	
	DEFM	'CLEAR'
	ADD	A,H
	RET	P
	NOP	
	DEFM	'CLOCK'
	ADD	A,D
	PUSH	HL
	NOP	
	DEFM	'CLS'
	ADC	A,C
	EX	(SP),HL
	DEFB	10H
	DEFM	'COPY'
	RET	NZ
	LD	C,B
	NOP	
	DEFM	'CREATE'
	ADD	A,D
	RET	P
	LD	B,B
	DEFM	'DATE'
	ADC	A,E
	JP	(HL)
	NOP	
	DEFM	'DEBUG'
	ADD	A,E
	PUSH	HL
	NOP	
	DEFM	'DIR'
	ADD	A,B
	DEFW	002AH
	DEFM	'CO'
	JP	8AEBH
	DEFM	'DUMP'
	ADD	A,A
	JP	(HL)
	RET	Z
	DEFM	'ERROR'
	ADD	A,A
	RET	P
	NOP	
	DEFM	'FORMAT'
	RET	NZ
	DEFW	0028H
	DEFM	'FREE'
	ADD	A,B
	LD	C,D
	NOP	
	DEFM	'HIMEM'
	ADD	A,D
	JP	(HL)
	NOP	
	DEFM	'JKL'
	ADD	A,B
	AND	L
	DEFB	10H
	DEFM	'KILL'
	ADD	A,B
	LD	B,L
	SUB	B
	DEFM	'LC'
	ADC	A,C
	PUSH	HL
	NOP	
	DEFM	'LCDVR'
	ADC	A,B
	PUSH	HL
	NOP	
	DEFM	'LIB'
	ADD	A,D
	EX	(SP),HL
	NOP	
	DEFM	'LIST'
	ADD	A,L
	RET	P
	ADC	A,B
	DEFM	'LOAD'
	ADD	A,B
	AND	H
	LD	D,B
	DEFM	'MDBORT'
	ADD	A,L
	EX	(SP),HL
	NOP	
	DEFM	'MDCOPY'
	ADD	A,D
	EX	DE,HL
	OR	B
	DEFM	'MDRET'
	ADD	A,(HL)
	EX	(SP),HL
	NOP	
	DEFM	'PAUSE'
	ADC	A,B
	EX	DE,HL
	NOP	
	DEFM	'PDRIVE'
	ADD	A,E
	JP	(HL)
	NOP	
	DEFM	'PRINT'
	ADD	A,(HL)
	RET	P
	ADC	A,B
	DEFM	'PROT'
	ADD	A,(HL)
	JP	(HL)
	NOP	
	DEFM	'PURGE'
	ADC	A,C
	JP	(HL)
	NOP	
	DEFM	'R'
	ADD	A,B
	INC	HL
	NOP	
	DEFM	'RENAME'
	ADD	A,C
	DEFW	0B0E4H
	DEFM	'ROUTE'
	ADD	A,C
	RET	P
	NOP	
	DEFM	'STMT'
	ADC	A,C
	EX	DE,HL
	NOP	
	DEFM	'SYSTEM'
	ADD	A,C
	JP	(HL)
	NOP	
	DEFM	'TIME'
	ADC	A,D
	JP	(HL)
	NOP	
	DEFM	'VERIFY'
	ADD	A,H
	PUSH	HL
	NOP	
	DEFM	'WRDIRP'
	ADD	A,B
	LD	D,E
	NOP	
	DEFM	'REGION'
	DEFB	80H
	DEFB	3FH
	DEFB	0
	NOP	
; NEWDOS/80 VERSION 2 FUNCTION ADDRESSES
COMBUFF	EQU	4318H	;ADDRESS OF COMMAND BUFFER
CURSOR	EQU	4020H	;ADDRESS OF CURSOR POSITION
DOS	EQU	402DH	;NO ERROR EXIT
DOSCOM	EQU	4405H	;ENTER DOS AND EXECUTE COMMAND
DOSERR	EQU	4409H	;DOS ERROR EXIT
DEBUG	EQU	440DH	;ENTER DEBUG
ENQUEUE	EQU	4410H	;ENQUEUE USER INTERRUPT ROUTINE
DEQUEUE	EQU	4413H	;DEQUEUE USER INTERRUPT ROUTINE
ROTATE	EQU	4416H	;KEEP DRIVES ROTATING
DOSCMD	EQU	4419H	;EXECUTE DOS COMMAND AND RETURN
EXTRACT	EQU	441CH	;EXTRACT A FILESPEC
OPEN$NW	EQU	4420H	;OPEN A NEW OR EXISTING FILE
OPEN$EX	EQU	4424H	;OPEN AN EXISTING FILE
CLOSE	EQU	4428H	;CLOSE A FILE
KILL	EQU	442CH	;KILL A FILE
LOAD	EQU	442CH	;LOAD A FILE
EXECUTE	EQU	4433H	;LOAD THEN EXECUTE A FILE
READ$RC	EQU	4436H	;READ A FILE'S RECORD
WRIT$RC	EQU	4439H	;WRITE A RECORD TO A FILE
REWIND	EQU	443FH	;REWIND FCB
POS$FCB	EQU	4442H	;POSITION FCB TO SPECIFIED RECORD
BACKSP	EQU	4445H	;BACKSPACE FCB ONE RECORD
POS$EOF	EQU	4448H	;POSITION FCB TO EOF
ALLOCAT	EQU	444BH	;ALLOCATE FILE SPACE
SELECT	EQU	445BH	;SELECT A DRIVE
MOUNT	EQU	445EH	;TEST FOR MOUNTED DISK
NAM$ENQ	EQU	4461H	;ENQUEUE *NAME ROUTINE
NAM$DEQ	EQU	4464H	;DEQUEUE *NAME ROUTINE
MESS$DI	EQU	4467H	;SEND MESSAGE TO DISPLAY
MESS$PR	EQU	446AH	;SEND MESSAGE TO PRINTER
TIME	EQU	446DH	;GET CURRENT TIME
DATE	EQU	4470H	;GET CURRENT DATE
EXTEND	EQU	4473H	;INSERT DEFAULT EXTENSION
READ$BY	EQU	0013H	;READ A BYTE FROM A FILE
WRIT$BY	EQU	001BH	;WRITE A BYTE TO A FILE
; END OF DOS ROUTINE CALL ADDRESSES.
	END	SYSRES
