;cp: Filesystem copy program.
;
	ORG	5300H
*GET	FILSYS
;
START	LD	SP,5300H
	CALL	FS_INIT
	JP	NZ,FS_DOS_ERROR
	PUSH	HL
	CALL	NEXTWORD
	CALL	FS_TERMINATE
	POP	HL
	PUSH	IX
	CALL	FS_TERMINATE
	LD	DE,FCB_IN
	LD	HL,BUF_IN
	LD	B,0
	CALL	FS_OPEN_EX
	JP	NZ,FS_DOS_ERROR
	POP	IX
	LD	DE,FCB_OUT
	LD	HL,BUF_OUT
	LD	B,0
	CALL	FS_OPEN_NEW
	JP	NZ,FS_DOS_ERROR
;
LOOP	LD	DE,FCB_IN
	CALL	ROM@GET
	JP	NZ,END_FILE
	LD	DE,FCB_OUT
	CALL	ROM@PUT
	JP	NZ,FS_DOS_ERROR
	JR	LOOP
END_FILE
	CP	1CH
	JP	NZ,FS_DOS_ERROR
	LD	DE,FCB_IN
	CALL	FS_CLOSE
	JP	NZ,FS_DOS_ERROR
	LD	DE,FCB_OUT
	CALL	FS_CLOSE
	JP	NZ,FS_DOS_ERROR
	JP	FS_DOS
;
NEXTWORD
	LD	A,(HL)
	INC	HL
	CP	' '
	JR	NZ,NEXTWORD
NWV01	LD	A,(HL)
	CP	' '
	INC	HL
	JR	Z,NWV01
	DEC	HL
	RET
;
FCB_IN	DEFS	32
BUF_IN	DEFS	256
FCB_OUT	DEFS	32
BUF_OUT	DEFS	256
	END	START
